#!/bin/sh
set -e

debian_deps="$debian_deps autoconf"
debian_deps="$debian_deps automake"
debian_deps="$debian_deps curl"
debian_deps="$debian_deps g++"
debian_deps="$debian_deps git"
debian_deps="$debian_deps libcurl4-openssl-dev"
debian_deps="$debian_deps libc-ares-dev"
debian_deps="$debian_deps libevent-dev"
debian_deps="$debian_deps libmaxminddb-dev"
debian_deps="$debian_deps libssl-dev"
debian_deps="$debian_deps libtool"
debian_deps="$debian_deps make"
debian_deps="$debian_deps python"
debian_deps="$debian_deps python-pip"
debian_deps="$debian_deps wget"
pip_deps="$pip_deps cpp-coveralls"

export CONFIGURE_FLAGS="--enable-coverage"

subr_finalize() {
    if [ "$COVERALLS_REPO_TOKEN" != "" ]; then
        $HOME/.local/bin/coveralls                                         \
                               --gcov-options '\-lp'                       \
                               --build-root .                              \
                               --exclude include/measurement_kit/ext       \
                               --exclude src/libmeasurement_kit/ext        \
                               --exclude src/libmeasurement_kit/portable   \
                               --exclude src/measurement_kit               \
                               --exclude example                           \
                               --exclude third_party                       \
                               --exclude builtin                           \
            > /dev/null;
    fi
}
